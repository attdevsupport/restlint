!function(f){"use strict";f.FileDialog=function(e){var r=f.extend(f.FileDialog.defaults,e),i=f(["<div class='modal fade'>","    <div class='modal-dialog'>","        <div class='modal-content'>","            <div class='modal-header'>","                <button type='button' class='close' data-dismiss='modal'>","                    <span aria-hidden='true'>&times;</span>","                    <span class='sr-only'>",r.cancel_button,"                    </span>","                </button>","                <h4 class='modal-title'>",r.title,"                </h4>","            </div>","            <div class='modal-body'>","                <input type='file' />","                <div class='bfd-dropfield'>","                    <div class='bfd-dropfield-inner'>",r.drag_message,"                    </div>","                </div>","                <div class='container-fluid bfd-files'>","                </div>","            </div>","            <div class='modal-footer'>","                <button type='button' class='btn btn-primary bfd-ok'>",r.ok_button,"                </button>","                <button type='button' class='btn btn-default bfd-cancel'","                                data-dismiss='modal'>",r.cancel_button,"                </button>","            </div>","        </div>","    </div>","</div>"].join("")),a=!1,t=f("input:file",i),o=f(".bfd-dropfield",i),n=f(".bfd-dropfield-inner",o);n.css({height:r.dropheight,"padding-top":r.dropheight/2-32}),t.attr({accept:r.accept,multiple:r.multiple}),o.on("click.bfd",function(){t.trigger("click")});var s=[],d=[],l=function(a){var o,t,n=new FileReader;d.push(n),n.onloadstart=function(){},n.onerror=function(e){e.target.error.code!==e.target.error.ABORT_ERR&&o.parent().html(["<div class='bg-danger bfd-error-message'>",r.error_message,"</div>"].join("\n"))},n.onprogress=function(e){var a=Math.round(100*e.loaded/e.total)+"%";o.attr("aria-valuenow",e.loaded),o.css("width",a),f(".sr-only",o).text(a)},n.onload=function(e){a.content=e.target.result,s.push(a),o.removeClass("active")};var e=f(["<div class='col-xs-7 col-sm-4 bfd-info'>","    <span class='glyphicon glyphicon-remove bfd-remove'></span>&nbsp;","    <span class='glyphicon glyphicon-file'></span>&nbsp;"+a.name,"</div>","<div class='col-xs-5 col-sm-8 bfd-progress'>","    <div class='progress'>","        <div class='progress-bar progress-bar-striped active' role='progressbar'","            aria-valuenow='0' aria-valuemin='0' aria-valuemax='"+a.size+"'>","            <span class='sr-only'>0%</span>","        </div>","    </div>","</div>"].join(""));o=f(".progress-bar",e),f(".bfd-remove",e).tooltip({container:"body",html:!0,placement:"top",title:r.remove_message}).on("click.bfd",function(){var e=s.indexOf(a);0<=e&&s.pop(e),t.fadeOut();try{n.abort()}catch(e){}}),(t=f("<div class='row'></div>")).append(e),f(".bfd-files",i).append(t),n["readAs"+r.readAs](a)},c=function(e){Array.prototype.forEach.apply(e,[l])};return t.change(function(e){var a=(e=e.originalEvent).target.files;c(a);var o=t.clone(!0);t.replaceWith(o),t=o}),o.on("dragenter.bfd",function(){n.addClass("bfd-dragover")}).on("dragover.bfd",function(e){(e=e.originalEvent).stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}).on("dragleave.bfd drop.bfd",function(){n.removeClass("bfd-dragover")}).on("drop.bfd",function(e){(e=e.originalEvent).stopPropagation(),e.preventDefault();var a=e.dataTransfer.files;a.length,c(a)}),f(".bfd-ok",i).on("click.bfd",function(){var e=f.Event("files.bs.filedialog");e.files=s,i.trigger(e),a=!0,i.modal("hide")}),i.on("hidden.bs.modal",function(){if(d.forEach(function(e){try{e.abort()}catch(e){}}),!a){var e=f.Event("cancel.bs.filedialog");i.trigger(e)}i.remove()}),f(document.body).append(i),i.modal(),i},f.FileDialog.defaults={accept:"*",cancel_button:"Close",drag_message:"Drop files here",dropheight:400,error_message:"An error occured while loading file",multiple:!0,ok_button:"OK",readAs:"DataURL",remove_message:"Remove&nbsp;file",title:"Load file(s)"}}(jQuery);