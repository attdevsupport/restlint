"use strict";var loadedFiles=[],xlsdata=[],readers=[];function dragenter(e){$("droparea").addClass("darea-dragover")}function dragleave(e){$("droparea").removeClass("darea-dragover")}function dragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function output(e){$("#droparea").append(txt)}function drop(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;t.length;$("#droparea-title").addClass("d-none");for(var a=0;a<t.length;a++){var r=t[a];$("#droparea-filelist").append("<li>"+t[a].name),genReader(r)}}function genReader(t){var e=new FileReader;readers.push(e),e.onerror=function(e){e.target.error.code,e.target.error.ABORT_ERR},e.onprogress=function(e){},e.onload=function(e){t.content=e.target.result,loadedFiles.push(t)},e.readAsText(t)}function addRow(e,t,a,r,l){var o,n=r,s="";"error"===r&&(n="danger"),o="<td>"+t+"</td><td>"+a+"</td><td>"+l+"</td>",(s=$("<tr class='table-"+n+"'></tr>")).append(o),$("#"+e+"-table-body").append(s);var d=[t,a,r,l];xlsdata[e].push(d)}function addSummaryRow(e,t,a,r){var l=t+a+r,o="";"total"===e?(o="<tr><th>"+capitalize(e)+"</th><th class='table-info'>"+t+"</th><th class='table-warning'>"+a+"</th><th class='table-danger'>"+r+"</th><th>"+l+"</th></tr>",$("#summary-table-footer").append(o)):(o="<tr><td>"+capitalize(e)+"</td><td class='table-info'>"+t+"</td><td class='table-warning'>"+a+"</td><td class='table-danger'>"+r+"</td><td>"+l+"</td><tr>",$("#summary-table-body").append(o)),xlsdata.summary.push([capitalize(e),t,a,r,l])}function getFiles(a){$("#file-upload");0!==a.length?($("#droparea-title").addClass("d-none"),Object.keys(a).forEach(function(e,t){genReader(a[t]),$("#droparea-filelist").append("<li>"+a[t].name)}),readFiles()):alert("Select one or more files")}function readFiles(){var e=!0,t=!1,a=void 0;try{for(var r,l=loadedFiles[Symbol.iterator]();!(e=(r=l.next()).done);e=!0){var o=r.value;JSON.parse(o.content);loadJson(o.content),checkDefinitions(),checkGeneral(),checkPathStructure("paths",getData("paths")),checkResources(getData("paths")),checkBasePath(),checkStatusCodes(getData("statuscodes")),checkMethods(getData("httpmethods")),$("#export-btn").removeClass("disabled"),$("#clear-btn").removeClass("disabled"),xlsdata.summary=[],xlsdata.summary.push(["Category","# of Infos","# of Warnings","# on Errors","Total"]);var s=0,d=0,i=0;getCategories().forEach(function(t,e){if("summary"!==t.title){xlsdata[t.title]=[];var a=t.columns.slice(0);console.log("CP: "+a),a.splice(2,0,"Level"),console.log("CP2: "+a),xlsdata[t.title].push(a);var r=0,l=0,o=0,n=1;getErrors(t.title).forEach(function(e){addRow(t.title,n,e.name,e.level,e.msg),n+=1,"warning"===e.level?r++:"error"===e.level?l++:"info"===e.level&&o++}),$("#"+t.title+"-issues").html("Total "+capitalize(t.title)+" issues: "+(r+l+o)+"; error: "+l+"; warning: "+r+"; info: "+o),addSummaryRow(t.title,o,r,l),i+=o,s+=r,d+=l}}),addSummaryRow("total",i,s,d)}}catch(e){t=!0,a=e}finally{try{!e&&l.return&&l.return()}finally{if(t)throw a}}}function clearTables(){getCategories().forEach(function(e){$("#"+e.title+"-table-body").children("tr").remove(),$("#"+e.title+"-issues").html(""),void 0!==xlsdata[e.title]&&(xlsdata[e.title].length=0)}),xlsdata=[],$("#summary-table-footer").children("tr").remove(),$("#droparea-title").removeClass("d-none"),$("#export-btn").addClass("disabled"),$("#clear-btn").addClass("disabled"),$("#droparea-filelist").text(""),$("#file-upload").val(""),loadedFiles.length=0}$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip(),$("#analyze-btn").click(function(){0!==loadedFiles.length&&(readFiles(),$("#results").collapse("show"),$("#summary-tab").tab("show"))}),$("#cancel-btn").click(function(){clearTables(),clearData()}),$("#clear-btn").click(function(){clearTables(),clearData()}),$("#export-btn").click(function(){if(console.log("KEYS: "+Object.keys(xlsdata)),0!==Object.keys(xlsdata).length){var y={info:"D6DBDF",warning:"F5CBA7",error:"F1948A"};XlsxPopulate.fromBlankAsync().then(function(e){var t=!0,a=!1,r=void 0;try{for(var l,o=getCategories()[Symbol.iterator]();!(t=(l=o.next()).done);t=!0){var n=l.value,s=e.addSheet(capitalize(n.title)),d=1,i=!0,c=!1,u=void 0;try{for(var f,p=xlsdata[n.title][Symbol.iterator]();!(i=(f=p.next()).done);i=!0){var h=f.value,g=h[2];"string"==typeof h[3]&&(h[3]=h[3].replace(/<em>|<\/em>/gi,"")),s.cell("A"+d).value([h]);var m="A"+d+":D"+d;void 0!==y[g]&&s.range(m).style("fill",y[g]),d++}}catch(e){c=!0,u=e}finally{try{!i&&p.return&&p.return()}finally{if(c)throw u}}s.row(1).style("bold",!0)}}catch(e){a=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw r}}var v=xlsdata.summary.length;e.sheet("Summary").range("B2:B"+v).style("fill",y.info),e.sheet("Summary").range("C2:C"+v).style("fill",y.warning),e.sheet("Summary").range("D2:D"+v).style("fill",y.error),e.deleteSheet("Sheet1"),e.outputAsync().then(function(e){var t="restlint-"+(new Date).toISOString()+".xlsx";if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(e,t);else{var a=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.href=a,r.download=t,r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r)}})})}})});