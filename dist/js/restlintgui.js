"use strict";var dragenter=function(t){$("droparea").addClass("darea-dragover")},dragleave=function(t){$("droparea").removeClass("darea-dragover")},dragover=function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},output=function(t){$("#droparea").append(txt)},drop=function(t){t.stopPropagation(),t.preventDefault();var e=t.dataTransfer.files;e.length;$("#droparea-title").addClass("d-none");for(var a=0;a<e.length;a++){var r=e[a];$("#droparea-filelist").append("<li>"+e[a].name),genReader(r)}},genReader=function(e){var t=new FileReader;readers.push(t),t.onerror=function(t){t.target.error.code,t.target.error.ABORT_ERR},t.onprogress=function(t){},t.onload=function(t){e.content=t.target.result,loadedFiles.push(e),$("#pastebin").val(""),$("#pastebin").val(e.content)},t.readAsText(e)},addRow=function(t,e,a,r,n){var l,o=r,s="";"error"===r&&(o="danger"),s=$("<tr class='table-"+o+"'></tr>"),l="<td>".concat(e,"</td><td>").concat(a,"</td><td>").concat(n,"</td>"),s.append(l),$("#"+t+"-table-body").append(s);var i=[e,a,r,n];xlsdata[t].push(i)},addSummaryRow=function(t,e,a,r){var n=e+a+r,l="";"total"===t?(l="<tr><th>".concat(capitalize(t),"</th><th class='table-info'>").concat(e,"</th><th class='table-warning'>").concat(a,"</th><th class='table-danger'>").concat(r,"</th><th>").concat(n,"</th></tr>"),$("#summary-table-footer").append(l)):(l="<tr><td>".concat(capitalize(t),"</td><td class='table-info'>").concat(e,"</td><td class='table-warning'>").concat(a,"</td><td class='table-danger'>").concat(r,"</td><td>").concat(n,"</td><tr>"),$("#summary-table-body").append(l)),xlsdata.summary.push([capitalize(t),e,a,r,n])},getFiles=function(a){$("#file-upload");if(0!==a.length){$("#droparea-title").addClass("d-none"),Object.keys(a).forEach(function(t,e){genReader(a[e]),$("#droparea-filelist").append("<li>"+a[e].name),$("#pastebin").val(a[e].content)});for(var t=0,e=loadedFiles;t<e.length;t++){var r=e[t];$("#pastebin").val(r.content)}}},readFiles=function(){for(var t=0,e=loadedFiles;t<e.length;t++){var a=e[t];loadContent(a.content)}},loadContent=function(t){JSON.parse(t);loadJson(t),checkDefinitions(),checkGeneral(),checkPathStructure("paths",getData("paths")),checkResources(getData("paths")),checkBasePath(),checkStatusCodes(getData("statuscodes")),checkMethods(getData("httpmethods")),$("#export-btn").removeClass("disabled"),$("#clear-btn").removeClass("disabled"),xlsdata.summary=[],xlsdata.summary.push(["Category","# of Infos","# of Warnings","# on Errors","Total"]);var s=0,i=0,d=0;getCategories().forEach(function(e,t){if("summary"!==e.title){xlsdata[e.title]=[];var a=e.columns.slice(0);a.splice(2,0,"Level"),xlsdata[e.title].push(a);var r=0,n=0,l=0,o=1;getErrors(e.title).forEach(function(t){addRow(e.title,o,t.name,t.level,t.msg),o+=1,"warning"===t.level?r++:"error"===t.level?n++:"info"===t.level&&l++}),$("#"+e.title+"-issues").html("Total ".concat(capitalize(e.title)," issues: ").concat(r+n+l,"; error: ").concat(n,"; warning: ").concat(r,"; info: ").concat(l)),addSummaryRow(e.title,l,r,n),d+=l,s+=r,i+=n}}),addSummaryRow("total",d,s,i)},clearTables=function(){getCategories().forEach(function(t){$("#"+t.title+"-table-body").children("tr").remove(),$("#"+t.title+"-issues").html(""),void 0!==xlsdata[t.title]&&(xlsdata[t.title].length=0)}),xlsdata=[],$("#summary-table-footer").children("tr").remove(),$("#droparea-title").removeClass("d-none"),$("#export-btn").addClass("disabled"),$("#clear-btn").addClass("disabled"),$("#droparea-filelist").text(""),$("#file-upload").val(""),loadedFiles.length=0,$("#pastebin").val("")},loadedFiles=[],xlsdata=[],readers=[];$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip(),$("#analyze-btn").click(function(){0!==$("#pastebin").val().trim().length&&(loadContent($("#pastebin").val().trim()),$("#results").collapse("show"),$("#summary-tab").tab("show"))}),$("#cancel-btn").click(function(){clearTables(),clearData()}),$("#clear-btn").click(function(){clearTables(),clearData()}),$("#export-btn").click(function(){if(0!==Object.keys(xlsdata).length){var b={info:"D6DBDF",warning:"F5CBA7",error:"F1948A"};XlsxPopulate.fromBlankAsync().then(function(t){var e=!0,a=!1,r=void 0;try{for(var n,l=getCategories()[Symbol.iterator]();!(e=(n=l.next()).done);e=!0){var o=n.value,s=t.addSheet(capitalize(o.title)),i=1,d=!0,c=!1,u=void 0;try{for(var f,p=xlsdata[o.title][Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var h=f.value,v=h[2];"string"==typeof h[3]&&(h[3]=h[3].replace(/<em>|<\/em>|<u>|<\/u>/gi,"")),s.cell("A"+i).value([h]);var g="A"+i+":D"+i;void 0!==b[v]&&s.range(g).style("fill",b[v]),i++}}catch(t){c=!0,u=t}finally{try{d||null==p.return||p.return()}finally{if(c)throw u}}s.row(1).style("bold",!0)}}catch(t){a=!0,r=t}finally{try{e||null==l.return||l.return()}finally{if(a)throw r}}var m=xlsdata.summary.length;t.sheet("Summary").range("B2:B"+m).style("fill",b.info),t.sheet("Summary").range("C2:C"+m).style("fill",b.warning),t.sheet("Summary").range("D2:D"+m).style("fill",b.error),t.deleteSheet("Sheet1"),t.outputAsync().then(function(t){var e="restlint-"+(new Date).toISOString()+".xlsx";if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(t,e);else{var a=window.URL.createObjectURL(t),r=document.createElement("a");document.body.appendChild(r),r.href=a,r.download=e,r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r)}})})}})});