"use strict";var loadedFiles=[],xlsdata=[],readers=[];function dragenter(e){$("droparea").addClass("darea-dragover")}function dragleave(e){$("droparea").removeClass("darea-dragover")}function dragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function output(e){$("#droparea").append(txt)}function drop(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;t.length;$("#droparea-title").addClass("d-none");for(var a=0;a<t.length;a++){var r=t[a];$("#droparea-filelist").append("<li>"+t[a].name),genReader(r)}}function genReader(t){var e=new FileReader;readers.push(e),e.onerror=function(e){e.target.error.code,e.target.error.ABORT_ERR},e.onprogress=function(e){},e.onload=function(e){t.content=e.target.result,loadedFiles.push(t)},e.readAsText(t)}function addRow(e,t,a,r,l){var n,o=r,d="";"error"===r&&(o="danger"),d=$("<tr class='table-"+o+"'></tr>"),n="<td>".concat(t,"</td><td>").concat(a,"</td><td>").concat(l,"</td>"),d.append(n),$("#"+e+"-table-body").append(d);var s=[t,a,r,l];xlsdata[e].push(s)}function addSummaryRow(e,t,a,r){var l=t+a+r,n="";"total"===e?(n="<tr><th>".concat(capitalize(e),"</th><th class='table-info'>").concat(t,"</th><th class='table-warning'>").concat(a,"</th><th class='table-danger'>").concat(r,"</th><th>").concat(l,"</th></tr>"),$("#summary-table-footer").append(n)):(n="<tr><td>".concat(capitalize(e),"</td><td class='table-info'>").concat(t,"</td><td class='table-warning'>").concat(a,"</td><td class='table-danger'>").concat(r,"</td><td>").concat(l,"</td><tr>"),$("#summary-table-body").append(n)),xlsdata.summary.push([capitalize(e),t,a,r,l])}function getFiles(a){$("#file-upload");0!==a.length&&($("#droparea-title").addClass("d-none"),Object.keys(a).forEach(function(e,t){genReader(a[t]),$("#droparea-filelist").append("<li>"+a[t].name)}),readFiles())}function readFiles(){for(var e=0;e<loadedFiles.length;e++){var t=loadedFiles[e];JSON.parse(t.content);loadJson(t.content),checkDefinitions(),checkGeneral(),checkPathStructure("paths",getData("paths")),checkResources(getData("paths")),checkBasePath(),checkStatusCodes(getData("statuscodes")),checkMethods(getData("httpmethods")),$("#export-btn").removeClass("disabled"),$("#clear-btn").removeClass("disabled"),xlsdata.summary=[],xlsdata.summary.push(["Category","# of Infos","# of Warnings","# on Errors","Total"]);var d=0,s=0,i=0;getCategories().forEach(function(t,e){if("summary"!==t.title){xlsdata[t.title]=[];var a=t.columns.slice(0);a.splice(2,0,"Level"),xlsdata[t.title].push(a);var r=0,l=0,n=0,o=1;getErrors(t.title).forEach(function(e){addRow(t.title,o,e.name,e.level,e.msg),o+=1,"warning"===e.level?r++:"error"===e.level?l++:"info"===e.level&&n++}),$("#"+t.title+"-issues").html("Total ".concat(capitalize(t.title)," issues: ").concat(r+l+n,"; error: ").concat(l,"; warning: ").concat(r,"; info: ").concat(n)),addSummaryRow(t.title,n,r,l),i+=n,d+=r,s+=l}}),addSummaryRow("total",i,d,s)}}function clearTables(){getCategories().forEach(function(e){$("#"+e.title+"-table-body").children("tr").remove(),$("#"+e.title+"-issues").html(""),void 0!==xlsdata[e.title]&&(xlsdata[e.title].length=0)}),xlsdata=[],$("#summary-table-footer").children("tr").remove(),$("#droparea-title").removeClass("d-none"),$("#export-btn").addClass("disabled"),$("#clear-btn").addClass("disabled"),$("#droparea-filelist").text(""),$("#file-upload").val(""),loadedFiles.length=0}$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip(),$("#analyze-btn").click(function(){0!==loadedFiles.length&&(readFiles(),$("#results").collapse("show"),$("#summary-tab").tab("show"))}),$("#cancel-btn").click(function(){clearTables(),clearData()}),$("#clear-btn").click(function(){clearTables(),clearData()}),$("#export-btn").click(function(){if(0!==Object.keys(xlsdata).length){var y={info:"D6DBDF",warning:"F5CBA7",error:"F1948A"};XlsxPopulate.fromBlankAsync().then(function(e){var t=!0,a=!1,r=void 0;try{for(var l,n=getCategories()[Symbol.iterator]();!(t=(l=n.next()).done);t=!0){var o=l.value,d=e.addSheet(capitalize(o.title)),s=1,i=!0,c=!1,u=void 0;try{for(var f,p=xlsdata[o.title][Symbol.iterator]();!(i=(f=p.next()).done);i=!0){var h=f.value,g=h[2];"string"==typeof h[3]&&(h[3]=h[3].replace(/<em>|<\/em>|<u>|<\/u>/gi,"")),d.cell("A"+s).value([h]);var m="A"+s+":D"+s;void 0!==y[g]&&d.range(m).style("fill",y[g]),s++}}catch(e){c=!0,u=e}finally{try{i||null==p.return||p.return()}finally{if(c)throw u}}d.row(1).style("bold",!0)}}catch(e){a=!0,r=e}finally{try{t||null==n.return||n.return()}finally{if(a)throw r}}var v=xlsdata.summary.length;e.sheet("Summary").range("B2:B"+v).style("fill",y.info),e.sheet("Summary").range("C2:C"+v).style("fill",y.warning),e.sheet("Summary").range("D2:D"+v).style("fill",y.error),e.deleteSheet("Sheet1"),e.outputAsync().then(function(e){var t="restlint-"+(new Date).toISOString()+".xlsx";if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(e,t);else{var a=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.href=a,r.download=t,r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r)}})})}})});